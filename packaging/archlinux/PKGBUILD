pkgname='flux'
pkgver='1.34.2'
pkgrel='1'
pkgdesc='An advanced automation daemon for X11 desktops and window managers. Designed to limit FPS/CPU usage and run commands on window focus and unfocus events. Provides gaming-oriented features. Written mostly in Bash and partially in C.'
arch=('any')
url='https://github.com/itz-me-zappex/flux'
license=('GPL-3.0-only')
makedepends=(
  'libxres'
  'libx11'
  'libxext'
  'xorgproto'
  'gcc'
  'make'
)
depends=(
  'bash'
  'util-linux'
  'cpulimit'
  'coreutils'
  'libxres'
  'libx11'
  'libxext'
  'xorgproto'
  'less'
)
optdepends=(
  'mangohud: FPS limit support'
  'lib32-mangohud: FPS limit support (32-bit)'
  'libnotify: notifications support'
  'libpulse: mute apps on unfocus'
)
source=("${url}/archive/refs/tags/v${pkgver}.tar.gz")
sha256sums=('SKIP')
install='group.install'

build(){
  cd "${srcdir}/${pkgname}-${pkgver}"
  make
}

package(){
  cd "${srcdir}/${pkgname}-${pkgver}"
  PREFIX="${pkgdir}/usr" make install
  mkdir -p "${pkgdir}/etc/security/limits.d"
  install -Dm644 '10-flux.conf' "${pkgdir}/etc/security/limits.d/"
}
